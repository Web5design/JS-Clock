<!DOCTYPE html>  <html> <head>   <title>jsclock-0.5.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /><link rel="shortcut icon" href="../favic    on.ico" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jsclock-0.5.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>!
JS Clock - jQuery Plugin version 0.5
http://thiago-cavalcanti.github.com/JS-Clock/    </p>

<p>Copyright (c) 2010 Thiago Cavalcanti Pimenta.
Dual licensed under the MIT and GPL version 3 licenses.
Check mit.txt and gpl.txt on this distribution for the respective licensing text.</p>

<p>Date: 2011-01-17 (Mon, 17 Jan 2011)</p>             </td>             <td class="code">               <div class="highlight"><pre> </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Use this way:</p>

<p>$('some-selector').jsclock();</p>

<p>to replace the innerHTML of the selected elements with a clock in sync with the client
time (uses Javascript's Date object) OR pass in some time string (server time, for
example) in HH:MM:SS format, like this:</p>

<p>$('some-selector').jsclock('14:29:36');</p>

<p>to have it count the time independently of the client time (built-in plugin clockwork
algorithm, NOT Javascript's Date object). NOTE: if at all possible, do try to measure
the mean delay introduced by the network and account for it in the time string you
pass into this plugin.</p>

<p>You CAN use more than one such clock on a single page, just try to make sure that if
you do so with multiple clocks showing the same time you use Sizzle to do it, like
this:</p>

<p>$('one-selector, another-selector, yet-another-selector').jsclock();</p>

<p>You should try to reduce the number of calls to JS Clock to just one for each time
string so DON'T do this:</p>

<p>$('first-selector').jsclock('14:29:36');
$('second-selector').jsclock('14:29:36');
$('third-selector').jsclock();
$('fourth-selector').jsclock();</p>

<p>If you want to, you can pass in some options such as "showCenti" and "countdown", like this:</p>

<p>$('some-selector').jsclock({showCenti:true});</p>

<p>to show a client time clock with Centiseconds display.</p>

<p>TODO: implement countdown and other options.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nx">jQuery</span>
<span class="nv">$.fn.jsclock = </span><span class="nf">(sTime, oConfig) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Correct the parameters assignments if only the configuration object has
been passed in.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="k">if</span> <span class="k">typeof</span> <span class="nx">sTime</span> <span class="o">is</span> <span class="s2">&quot;object&quot;</span>
      <span class="nv">oConfig = </span><span class="nx">sTime</span>
      <span class="nv">sTime   = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Both the Date object approach and the built-in clockwork algorithm need these.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="nv">iCurrentHour   = </span><span class="mi">0</span>
   <span class="nv">iCurrentMinute = </span><span class="mi">0</span>
   <span class="nv">iCurrentSecond = </span><span class="mi">0</span>
   <span class="nv">iCurrentCenti  = </span><span class="mi">0</span>
   <span class="nv">sCurrentTime   = </span><span class="s2">&quot;&quot;</span>
   <span class="nv">oApplyTo       = </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This is a utility function used by both approaches.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="nv">updateTimeString = </span><span class="o">-&gt;</span>
      <span class="nv">addLeadingZero = </span><span class="nf">(iTimeStringFragment) -&gt;</span>
         <span class="k">if</span> <span class="nx">iTimeStringFragment</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">and</span> <span class="nx">iTimeStringFragment</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="mi">2</span>
            <span class="nv">iTimeStringFragment = </span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nx">iTimeStringFragment</span>
         <span class="k">return</span> <span class="nx">iTimeStringFragment</span>
      <span class="nv">iCurrentHour   = </span><span class="nx">addLeadingZero</span><span class="p">(</span><span class="nx">iCurrentHour</span><span class="p">)</span>
      <span class="nv">iCurrentMinute = </span><span class="nx">addLeadingZero</span><span class="p">(</span><span class="nx">iCurrentMinute</span><span class="p">)</span>
      <span class="nv">iCurrentSecond = </span><span class="nx">addLeadingZero</span><span class="p">(</span><span class="nx">iCurrentSecond</span><span class="p">)</span>
      <span class="nv">iCurrentCenti  = </span><span class="nx">addLeadingZero</span><span class="p">(</span><span class="nx">iCurrentCenti</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">oConfig</span><span class="o">?</span> <span class="o">and</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span> <span class="o">is</span> <span class="kc">true</span>
         <span class="nv">sCurrentTime = </span><span class="s2">&quot;#{iCurrentHour}:#{iCurrentMinute}:#{iCurrentSecond}:#{iCurrentCenti}&quot;</span>
      <span class="k">else</span>
         <span class="nv">sCurrentTime = </span><span class="s2">&quot;#{iCurrentHour}:#{iCurrentMinute}:#{iCurrentSecond}&quot;</span>
      <span class="nx">oApplyTo</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">sCurrentTime</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This RegEx matches time strings in the format HH:MM:SS
Hours, minutes and seconds are all REQUIRED, as are the leading zeros, if any.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="nv">rValidateTimeString = </span><span class="sr">/^(([01][0-9])|(2[0-3])):[0-5][0-9]:[0-5][0-9]$/</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Checking if the configuration values exist and, if so, if they're valid.
Warn and cease if there is a problem.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="k">if</span> <span class="nx">oConfig</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">countdown</span><span class="o">?</span>
         <span class="k">if</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">countdown</span> <span class="o">isnt</span> <span class="kc">true</span> <span class="o">and</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">countdown</span> <span class="o">isnt</span> <span class="kc">false</span>
            <span class="nx">oApplyTo</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;countdown value must either be &quot;true&quot; or &quot;false&quot;.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span><span class="o">?</span>
         <span class="k">if</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span> <span class="o">isnt</span> <span class="kc">true</span> <span class="o">and</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span> <span class="o">isnt</span> <span class="kc">false</span>
            <span class="nx">oApplyTo</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;showCenti value must either be &quot;true&quot; or &quot;false&quot;.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>If a time string has been passed we'll use the clockwork algorithm.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="k">if</span> <span class="nx">sTime</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Need to make sure it's a valid time string before proceeding.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">rValidateTimeString</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">sTime</span><span class="p">)</span>
         <span class="nv">aHoursMinutesSeconds = </span><span class="nx">sTime</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
         <span class="nv">iCurrentHour         = </span><span class="nx">aHoursMinutesSeconds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         <span class="nv">iCurrentMinute       = </span><span class="nx">aHoursMinutesSeconds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
         <span class="nv">iCurrentSecond       = </span><span class="nx">aHoursMinutesSeconds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Clockwork algorithm.</p>             </td>             <td class="code">               <div class="highlight"><pre>         <span class="nv">clockwork = </span><span class="o">-&gt;</span>
            <span class="nv">baseclock = </span><span class="o">-&gt;</span>
               <span class="k">if</span> <span class="nx">iCurrentSecond</span> <span class="o">&lt;</span> <span class="mi">59</span>
                  <span class="nx">iCurrentSecond</span><span class="o">++</span>
               <span class="k">else</span>
                  <span class="nv">iCurrentSecond = </span><span class="mi">0</span>
                  <span class="k">if</span> <span class="nx">iCurrentMinute</span> <span class="o">&lt;</span> <span class="mi">59</span>
                     <span class="nx">iCurrentMinute</span><span class="o">++</span>
                  <span class="k">else</span>
                     <span class="nv">iCurrentMinute = </span><span class="mi">0</span>
                     <span class="k">if</span> <span class="nx">iCurrentHour</span> <span class="o">&lt;</span> <span class="mi">23</span>
                        <span class="nx">iCurrentHour</span><span class="o">++</span>
                     <span class="k">else</span>
                        <span class="nv">iCurrentHour = </span><span class="mi">0</span>
            <span class="nv">simpleclock = </span><span class="o">-&gt;</span>
               <span class="nx">baseclock</span><span class="p">()</span>
               <span class="nx">updateTimeString</span><span class="p">()</span>
               <span class="p">(</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">simpleclock</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
            <span class="nv">fullclock = </span><span class="o">-&gt;</span>
               <span class="k">if</span> <span class="nx">iCurrentCenti</span> <span class="o">&lt;</span> <span class="mi">99</span>
                  <span class="nx">iCurrentCenti</span><span class="o">++</span>
               <span class="k">else</span>
                  <span class="nv">iCurrentCenti = </span><span class="mi">0</span>
                  <span class="nx">baseclock</span><span class="p">()</span>
               <span class="nx">updateTimeString</span><span class="p">()</span>
               <span class="p">(</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">fullclock</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="k">if</span> <span class="nx">oConfig</span><span class="o">?</span> <span class="o">and</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span> <span class="o">is</span> <span class="kc">true</span>
               <span class="nx">fullclock</span><span class="p">()</span>
            <span class="k">else</span> <span class="nx">simpleclock</span><span class="p">()</span>
         <span class="nx">clockwork</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Warn developer if he/she messed up the time string parameter to this plugin.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
         <span class="nx">oApplyTo</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;Time string &lt;strong&gt;must&lt;/strong&gt; be in the format &quot;HH:MM:SS&quot;. Hours, minutes and seconds are all &lt;strong&gt;REQUIRED&lt;/strong&gt;, as are the leading zeros, if any.&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>If there was no time string we let the Date object do the heavy-lifting.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="k">else</span>
      <span class="nv">clientClock = </span><span class="o">-&gt;</span>
         <span class="nv">baseclock = </span><span class="o">-&gt;</span>
            <span class="nv">oCurrentDate   = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
            <span class="nv">iCurrentHour   = </span><span class="nx">oCurrentDate</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span>
            <span class="nv">iCurrentMinute = </span><span class="nx">oCurrentDate</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span>
            <span class="nv">iCurrentSecond = </span><span class="nx">oCurrentDate</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span>
         <span class="nv">simpleclock = </span><span class="o">-&gt;</span>
            <span class="nx">baseclock</span><span class="p">()</span>
            <span class="nx">updateTimeString</span><span class="p">()</span>
            <span class="p">(</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">simpleclock</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
         <span class="nv">fullclock = </span><span class="o">-&gt;</span>
            <span class="k">if</span> <span class="nx">bFirstTime</span><span class="o">?</span>
               <span class="k">if</span> <span class="nx">iCurrentCenti</span> <span class="o">&lt;</span> <span class="mi">99</span>
                  <span class="nx">iCurrentCenti</span><span class="o">++</span>
               <span class="k">else</span>
                  <span class="nv">iCurrentCenti = </span><span class="mi">0</span>
                  <span class="nx">baseclock</span><span class="p">()</span>
            <span class="k">else</span>
               <span class="nx">baseclock</span><span class="p">()</span>
               <span class="nv">oCurrentDate  = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
               <span class="nv">iCurrentCenti = </span><span class="nx">oCurrentDate</span><span class="p">.</span><span class="nx">getMilliseconds</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
               <span class="nv">bFirstTime    = </span><span class="kc">true</span>
            <span class="nx">updateTimeString</span><span class="p">()</span>
            <span class="p">(</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">fullclock</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
         <span class="k">if</span> <span class="nx">oConfig</span><span class="o">?</span> <span class="o">and</span> <span class="nx">oConfig</span><span class="p">.</span><span class="nx">showCenti</span> <span class="o">is</span> <span class="kc">true</span>
            <span class="nx">fullclock</span><span class="p">()</span>
         <span class="k">else</span> <span class="nx">simpleclock</span><span class="p">()</span>
      <span class="nx">clientClock</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
